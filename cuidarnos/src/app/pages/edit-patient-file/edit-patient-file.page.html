<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/doctor/patient-search"></ion-back-button>
    </ion-buttons>
    <ion-title>Editar Ficha del Paciente</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="edit-patient-container">

    <!-- Datos básicos de ficha médica -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Datos Personales</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-item>
          <ion-label position="stacked">Contacto de emergencia</ion-label>
          <ion-input [(ngModel)]="ficha.contacto_emergencia" placeholder="Nombre del contacto"></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Parentesco</ion-label>
          <ion-input [(ngModel)]="ficha.parentezco_contacto" placeholder="Ej: Madre, Hermano"></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Altura (cm)</ion-label>
          <ion-input type="number" [(ngModel)]="ficha.altura"></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Peso (kg)</ion-label>
          <ion-input type="number" [(ngModel)]="ficha.peso"></ion-input>
        </ion-item>
      </ion-card-content>
    </ion-card>

<!-- Condiciones médicas -->
<ion-card>
  <ion-card-header>
    <ion-card-title>Condiciones Médicas</ion-card-title>
    <ion-button fill="clear" size="small" (click)="addCondicion()">
      <ion-icon name="add-circle-outline" slot="start"></ion-icon>Agregar
    </ion-button>
  </ion-card-header>

  <ion-card-content>
    <!-- Formulario para nueva condición médica -->
    <div *ngIf="agregandoCondicion" class="form-condicion">
      <ion-item>
        <ion-label position="stacked">Nombre</ion-label>
        <ion-input [(ngModel)]="nuevaCondicion.nombre" required></ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="stacked">Severidad</ion-label>
        <ion-select [(ngModel)]="nuevaCondicion.severidad">
          <ion-select-option value="Severa">Severa</ion-select-option>
          <ion-select-option value="Moderada">Moderada</ion-select-option>
        </ion-select>
      </ion-item>

      <ion-item>
        <ion-label position="stacked">Estado</ion-label>
        <ion-input [(ngModel)]="nuevaCondicion.estado"></ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="stacked">Notas</ion-label>
        <ion-textarea [(ngModel)]="nuevaCondicion.notas" autoGrow="true"></ion-textarea>
      </ion-item>

      <ion-button expand="block" color="success" (click)="guardarCondicion()">Guardar Condición</ion-button>
      <ion-button expand="block" fill="clear" color="medium" (click)="cancelarAgregarCondicion()">Cancelar</ion-button>
    </div>

    <!-- Lista de condiciones existentes -->
    <ion-list *ngIf="condiciones.length > 0">
      <ion-item-sliding *ngFor="let c of condiciones">
        <ion-item>
          <ion-label>
            <h2>{{ c.nombre }}</h2>
            <p><strong>Severidad:</strong> {{ c.severidad }}</p>
            <p><strong>Estado:</strong> {{ c.estado }}</p>
            <p><strong>Notas:</strong> {{ c.notas || 'Sin notas' }}</p>
          </ion-label>
          <ion-buttons slot="end">
            <ion-button color="warning" (click)="editarCondicion(c)">
              <ion-icon name="create-outline" slot="icon-only"></ion-icon>
            </ion-button>
            <ion-button color="danger" (click)="eliminarCondicion(c)">
              <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-item>
      </ion-item-sliding>
    </ion-list>
  </ion-card-content>
</ion-card>


    <!-- Alergias -->
    <ion-card>
  <ion-card-header>
    <ion-card-title>Alergias</ion-card-title>
    <ion-button fill="clear" size="small" (click)="addAlergia()">
      <ion-icon name="add-circle-outline" slot="start"></ion-icon>Agregar
    </ion-button>
  </ion-card-header>

  <ion-card-content>
    <!-- Formulario de nueva alergia -->
    <div *ngIf="agregandoAlergia" class="form-alergia">
      <ion-item>
        <ion-label position="stacked">Descripción</ion-label>
        <ion-input [(ngModel)]="nuevaAlergia.descripcion" required></ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="stacked">Severidad</ion-label>
        <ion-select [(ngModel)]="nuevaAlergia.severidad">
          <ion-select-option value="Leve">Leve</ion-select-option>
          <ion-select-option value="Moderada">Moderada</ion-select-option>
          <ion-select-option value="Severa">Severa</ion-select-option>
        </ion-select>
      </ion-item>

      <ion-item>
        <ion-label position="stacked">Causa</ion-label>
        <ion-input [(ngModel)]="nuevaAlergia.causa"></ion-input>
      </ion-item>

      <ion-button expand="block" color="success" (click)="guardarAlergia()">Guardar Alergia</ion-button>
      <ion-button expand="block" fill="clear" color="medium" (click)="cancelarAgregarAlergia()">Cancelar</ion-button>
    </div>

    <!-- Lista de alergias -->
    <ion-list *ngIf="alergias.length > 0">
      <ion-item-sliding *ngFor="let a of alergias">
        <ion-item>
          <ion-label>
            <h2>{{ a.descripcion }}</h2>
            <p><strong>Severidad:</strong> {{ a.severidad }}</p>
            <p><strong>Causa:</strong> {{ a.causa || 'No especificada' }}</p>
          </ion-label>
          <ion-buttons slot="end">
            <ion-button color="warning" (click)="editarAlergia(a)">
              <ion-icon name="create-outline" slot="icon-only"></ion-icon>
            </ion-button>
            <ion-button color="danger" (click)="eliminarAlergia(a)">
              <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-item>
      </ion-item-sliding>
    </ion-list>
  </ion-card-content>
</ion-card>

    <!-- Medicamentos -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Medicamentos</ion-card-title>
        <ion-button fill="clear" size="small" (click)="addMedicamento()">
          <ion-icon name="add-circle-outline" slot="start"></ion-icon>Agregar
        </ion-button>
      </ion-card-header>
      <ion-card-content>
        <!-- Aquí se listarán los medicamentos -->
        <!-- Si no hay receta, se deberá crear una antes de insertar medicamentos -->
      </ion-card-content>
    </ion-card>

    <!-- Botón para guardar todos los cambios -->
    <ion-footer>
      <ion-toolbar>
        <ion-button expand="block" color="primary" (click)="guardarCambios()">Guardar Cambios</ion-button>
      </ion-toolbar>
    </ion-footer>

  </div>
</ion-content>
